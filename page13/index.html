<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta content='width=device-width, initial-scale=1.0' name='viewport' />
    <meta content='text/html; charset=utf-8' http-equiv='content-type' />
    <meta content='Nicholas Fine' name='author' />
    <link href='http://feeds.feedburner.com/ndfine' rel='alternate' title='Nicholas Fine' type='application/atom+xml' />
    <link href='http://fonts.googleapis.com/css?family=Lato|Merriweather' rel='stylesheet' type='text/css' />
    <link href='/assets/screen.css' media='screen' rel='stylesheet' type='text/css' />
    <script src='//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js' type='text/javascript'></script>
    <script src='/assets/application.js' type='text/javascript'></script>
    <script type='text/javascript'>
      //<![CDATA[
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-126126-3']);
        _gaq.push(['_trackPageview']);
        
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      //]]>
    </script>
    <title>Nicholas Fine</title>
  </head>
  <body>
    <div class='navbar'>
      <div class='navbar-inner'>
        <div class='container-fluid'>
          <a class='brand' href='/'>
            <h2>
              Nicholas Fine
            </h2>
          </a>
        </div>
      </div>
    </div>
    <div class='container-fluid'>
      <div class='row-fluid'>
        <div class='span8'>
          
  <article>
    <div class='well'>
      
        <h2><a href='/2011/02/24/groupwise-max-rails3.html'>Finding The Group-wise Maximum in Rails3 / Arel</a></h2>
      
      <span class='label'>24 Feb 2011</span>
      
    </div>
    
      <p><a href="http://www.isotope11.com/blog/group-wise-max-rails3">cross posted at Isotope11’s blog</a></p>

<p>Recently at work we ran across a situation where we needed an efficient way
to find the <a href="http://dev.mysql.com/doc/refman/5.0/en/example-maximum-column-group-row.html">Group-wise maximum of a certain column</a>
in an efficient manner.  After fighting with and realizing that there is apparently no way to make MySQL
combine an ORDER BY statement with a GROUP BY statement, we were able to get the results with two queries,
but due to the volume of data, this would eventually have too much overhead to be sustainable.<br />
Once I determined that using a left join on itself would be the way to go at the problem, I set 
out to figure out the solution using the new <a href="https://github.com/rails/arel">Arel syntax</a>.</p>

<h5 id="example">Example</h5>

<p>This example uses two models, ParentThing and ChildThing, with ChildThing being a basic key-value store.
ChildThings can have duplicate rows with the same key, and we were looking to return only the newest
results for each distinct key found in the ParentThing’s ChildThings.</p>

<pre><code>class ParentThing &lt; ActiveRecord::Base
  has_many :child_things
end

class ChildThing &lt; ActiveRecord::Base
  belongs_to :parent_thing
end
</code></pre>

<p>The solution was to add a single named scope to the ChildThing class:</p>

<pre><code>class ChildThing &lt; ActiveRecord::Base
  belongs_to :parent_thing

  scope :newest_results, 
    joins('LEFT JOIN child_things c2 ON child_things.key = c2.key AND child_things.created_at &gt; c2.created_at'),
    where('c2.key is NULL')

end
</code></pre>

<p>So, now if p is an instance of ParentThing: </p>

<pre><code>p.child_things.newest_results 
</code></pre>

<p>will return a collection that contains the newest created ChildThing for each disparate key in the ParentThing’s ChildThing
full collection.</p>


    
  </article>

  <article>
    <div class='well'>
      
        <h2><a href='/2011/02/07/random-links.html'>Some Random Links</a></h2>
      
      <span class='label'>07 Feb 2011</span>
      
    </div>
    
      <p>I’m still not so great on updating this on the regular.  I’ve been digging
through old photos and doing some processing on my huge cache of live music
shots, which has been a fun trip down nostalgia lane.</p>

<p>Beyond that, I’m here to rep:</p>

<p><a href="http://bamareport.blogspot.com/2011/02/university-of-alabama-football-report.html">My favorite Alabama Football blogger in memory of his dog…</a>
&gt; My dog is reference-able in a university library system. She’s mentioned by name in the acknowledgments of my master’s thesis.  That’s the section where my classmates put their thesis chairs’ names. My thesis chair went on sabbatical for half the damn year; my dog was there every day.</p>

<p><a href="http://teddziuba.com/2011/02/the-case-against-queues.html">The case against queues…</a>
&gt; Depending on your queue implementation, when you pop a message off, it’s gone. The consumer acknowledges receipt of it, and the queue forgets about it. So, if your data processor fails, you’ve got data loss. Collecting messages [with] syslog, your processor program is just processing a text file, and can process it again if something goes wrong. Throw in some split and xargs, and you’ve got parallel processing. Event messages aren’t text? You fucked up. Go buy a subscription to the Microsoft Developer Network.</p>

    
  </article>

  <article>
    <div class='well'>
      
        <h2><a href='/2011/01/24/too-cold.html'>Entirely Too Cold</a></h2>
      
      <span class='label'>24 Jan 2011</span>
      
    </div>
    
      <p>It was entirely too cold here in Alabama for a while.  Abstracts from photographs of the ice:</p>

<p><a href="/images/abstracts/ice_abstract1.jpg"><img src="/images/abstracts/thumbs/ice_abstract1.jpg" alt="Ice Abstract 1 - January 2011" /></a>
<a href="/images/abstracts/ice_abstract2.jpg"><img src="/images/abstracts/thumbs/ice_abstract2.jpg" alt="Ice Abstract 2 - January 2011" /></a>
<a href="/images/abstracts/ice_abstract3.jpg"><img src="/images/abstracts/thumbs/ice_abstract3.jpg" alt="Ice Abstract 3 - January 2011" /></a>
<a href="/images/abstracts/ice_abstract4.jpg"><img src="/images/abstracts/thumbs/ice_abstract4.jpg" alt="Ice Abstract 4 - January 2011" /></a></p>


    
  </article>

  <article>
    <div class='well'>
      
        <h2><a href='/2011/01/23/nola-photographs.html'>NOLA 2010 - Five Photographs</a></h2>
      
      <span class='label'>23 Jan 2011</span>
      
    </div>
    
      <p>Five photographs from New Orleans.  The first four are from my honeymoon in June 2010, and the last is presumably a group of Vietnamese veterans marching in the Veteran’s Day parade last year.  </p>

<p><a href="/images/nola/nola_1.jpg"><img src="/images/nola/thumbs/nola_1.jpg" alt="NOLA 1 - June 2010" /></a>
<a href="/images/nola/nola_2.jpg"><img src="/images/nola/thumbs/nola_2.jpg" alt="NOLA 2 - June 2010" /></a>
<a href="/images/nola/nola_3.jpg"><img src="/images/nola/thumbs/nola_3.jpg" alt="NOLA 3 - June 2010" /></a>
<a href="/images/nola/nola_4.jpg"><img src="/images/nola/thumbs/nola_4.jpg" alt="NOLA 4 - June 2010" /></a>
<a href="/images/nola/nola_5.jpg"><img src="/images/nola/thumbs/nola_5.jpg" alt="NOLA 5 - November 2010" /></a></p>


    
  </article>

  <article>
    <div class='well'>
      
        <h2><a href='/2011/01/20/six-letter-dot-com.html'>Six letter dot com</a></h2>
      
      <span class='label'>20 Jan 2011</span>
      
    </div>
    
      <p>Considering that I make my living predominantly writing code that runs on webservers, I had a lingering sense of guilt that I had no “web presence” to speak of outside of a mostly-ignored Facebook profile and a neglected Twitter account. Way back in the internet dark-ages I used to have a blog, but have long since allowed all my domains to expire. Figuring that the large majority of short .com addresses would have been mostly snatched up by now, I was kind of shocked to find I could once again be the proud owner of ndfine.com.  Welcome to the result.  </p>

    
  </article>


<ul class='pager'>
  
    <li>
      
        <a href='/page12'>Previous</a>
      
    </li>
  
  
</ul>
  


        </div>
        <div class='span4 offset1'>
          <div class='well sidebar-nav'>
            <ul class='nav nav-list'>
              <li class='nav-header'>
                Ceci n'est pas un menu
              </li>
              <li>
                <a href='/about'>
                  <i class='icon-user'></i>
                  About
                </a>
              </li>
              <li>
                <a href='/posts'>
                  <i class='icon-book'></i>
                  Archives
                </a>
              </li>
              <li>
                <a href='http://github.com/yrgoldteeth'>
                  <i class='icon-cog'></i>
                  GitHub
                </a>
              </li>
              <li>
                <a href='http://pinboard.in/u:ndfine'>
                  <i class='icon-folder-open'></i>
                  Pinboard
                </a>
              </li>
              <li>
                <a href='http://twitter.com/yrgoldteeth'>
                  <i class='icon-retweet'></i>
                  Twitter
                </a>
              </li>
              <li>
                <a href='http://www.goodreads.com/user/show/15896929-nicholas-fine'>
                  <i class='icon-book'></i>
                  Goodreads
                </a>
              </li>
              <li>
                <a href='mailto:nick@ndfine.com'>
                  <i class='icon-envelope'></i>
                  Email
                </a>
              </li>
              <li>
                <a href='http://feeds.feedburner.com/ndfine'>
                  <i class='icon-share-alt'></i>
                  Feed
                </a>
              </li>
              <li class='nav-header'>
                Projects
              </li>
              <li>
                <a href='https://github.com/yrgoldteeth/crisco'>Crisco URL Shortener</a>
              </li>
              <li>
                <a href='http://annotatethebastards.org'>Annotate the Bastards!</a>
              </li>
              <li>
                <a href='http://yrgoldteeth.github.com/darkdowncss'>Darkdown.css</a>
              </li>
              <li>
                <a href='http://yrgoldteeth.github.com/whereabouts'>Whereabouts Plugin</a>
              </li>
              <li>
                <a href='https://github.com/yrgoldteeth/teleportd'>Teleportd Gem</a>
              </li>
              <li>
                <a href='https://github.com/yrgoldteeth/city_grid'>City Grid Gem</a>
              </li>
              <li>
                <a href='https://github.com/yrgoldteeth/hungrytable'>Hungrytable Gem</a>
              </li>
              <li>
                <a href='https://rubygems.org/gems/bootstrap-will_paginate/'>Bootstrap-will_paginate Gem</a>
              </li>
              <li>
                <a href='https://rubygems.org/gems/css3-progress-bar-rails/'>CSS3-progress-bar-rails Gem</a>
              </li>
              <li class='nav-header'>
                Colophon
              </li>
              <li>
                <a href='http://github.com/mojombo/jekyll'>Jekyll</a>
              </li>
              <li>
                <a href='http://twitter.github.com/bootstrap/'>Twitter Bootstrap</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
